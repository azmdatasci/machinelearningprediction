Quantify activity assignment
============================

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Synopsis

Jawbone Up, Nike FuelBand, and Fitbit are part of the quantified self movement ??? a group of enthusiasts who take measurements about themselves regularly to improve their health, to find patterns in their behavior, or because they are tech geeks. In this project, data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants who performed barbell lifts correctly and incorrectly in 5 different ways is used. The goal is to predict the manner in which they did the exercise in a testing data set. The data for this project come from this source: http://groupware.les.inf.puc-rio.br/har. 

## Data Processing 
The data comes in the form of a comma-separated-value file and it is separated into a pml-training and pml-testing set. It has been downloaded directly from the provided *url* and imported to R using read.csv. 
```{r cache = TRUE}
urltrain = "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
filetrain = "pmt-training.csv"
if (!file.exists(filetrain)){
  download.file(urltrain,filetrain)
}
if (!exists("training")){
  training <- read.csv(filetrain)
}
urltest = "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"
filetest = "pmt-testing.csv"
if (!file.exists(filetest)){
  download.file(urltest,filetest)
}
if (!exists("testing")){
  testing <- read.csv(filetest)
}
```
The classe of the pml-testing dataset is predicted using the developed model. The pml-training dataset is splitted into a training, testing and cross-validation dataset. The cross validation dataset is used to estimate the out of sample error.
```{r}
str(training)
table(is.na(training))
```
- INJURIES: Injuries caused by weather events (no missing values)
```{r}
summary(rawdata$INJURIES)
table(is.na(rawdata$INJURIES))
```
Other two describe economic consequences:
- PROPDMG: Damage to properties (no missing values)
```{r}
summary(rawdata$PROPDMG)
table(is.na(rawdata$PROPDMG))
```
- CROPDMG: Damage to crop (no missing values)
```{r}
summary(rawdata$CROPDMG)
table(is.na(rawdata$CROPDMG))
```

## Results 
### Health consequences
The injury data is retrieved first by aggregating the injuries by event type. The resulting data frame is ordered in decreasing order and the event types with 0 ocurrences are deleted.
```{r}
injury <- aggregate(INJURIES ~ EVTYPE,data=rawdata,FUN="sum")
injury <- subset(injury,INJURIES>0)
orderer <- order(injury$INJURIES,decreasing = TRUE)
injury <- injury[orderer,]
```
The data about fatalities is aggregated in the same way
```{r}
fatality <- aggregate(FATALITIES ~ EVTYPE,data=rawdata,FUN="sum")
fatality <- subset(fatality,FATALITIES>0)
orderer <- order(fatality$FATALITIES,decreasing = TRUE)
fatality <- fatality[orderer,]
```

The number of injuries `r sum(injury$INJURIES)` is higher than the number of fatalities `r sum(fatality$FATALITIES)`. The data is plotted to better visualize the trends. First the number of injuries and fatalities are rewritten as fractions.
```{r}
injury$INJURIES <- injury$INJURIES/sum(injury$INJURIES)
fatality$FATALITIES <- fatality$FATALITIES/sum(fatality$FATALITIES)
yrange <- range(injury$INJURIES,fatality$FATALITIES)
par(mfrow=c(1,2),mar=c(11,4,1,1))
plot(seq(1,15),injury$INJURIES[1:15],xaxt = "n",type="b",xlab="",ylab="Injuries", ylim = yrange)
axis(1, at=1:15, labels=injury$EVTYPE[1:15],las=2)
plot(seq(1,15),fatality$FATALITIES[1:15],xaxt = "n",type="b",xlab="",ylab="Fatalities", ylim = yrange)
axis(1, at=1:15, labels=fatality$EVTYPE[1:15],las=2)
```

The tornados are clearly the main source of population health problems. Strong wind, floods, excesive heat and lightning are next events causing more injuries but with much lower ocurrences. Excessive heat is the second reason for fatalities. Flash floods, heat and lightnings are also causing relatively high number of fatalities.

### Economic consequences
The aggregation of the data about property and crop damage is done as in the previous case. The data about the damage to the properties is retrieved as: 
```{r}
property <- aggregate(PROPDMG ~ EVTYPE,data=rawdata,FUN="sum")
property <- subset(property,PROPDMG>0)
orderer <- order(property$PROPDMG,decreasing = TRUE)
property <- property[orderer,]
```
And for damage to crops:
```{r}
crop <- aggregate(CROPDMG ~ EVTYPE,data=rawdata,FUN="sum")
crop <- subset(crop,CROPDMG>0)
orderer <- order(crop$CROPDMG,decreasing = TRUE)
crop <- crop[orderer,]
```
The total number of damage events to the property are `r sum(property$PROPDMG)` and the number of damage events to the crop are `r sum(crop$CROPDMG)`. The fraction of damages are plotted next:
```{r}
property$PROPDMG1 <- property$PROPDMG/sum(property$PROPDMG)
crop$CROPDMG1 <- crop$CROPDMG/sum(crop$CROPDMG)
yrange <- range(property$PROPDMG1,crop$CROPDMG1)
par(mfrow=c(1,2),mar=c(11,4,1,1))
plot(seq(1,15),property$PROPDMG1[1:15],xaxt = "n",type="b",xlab="",ylab="Property", ylim = yrange)
axis(1, at=1:15, labels=property$EVTYPE[1:15],las=2)
plot(seq(1,15),crop$CROPDMG1[1:15],xaxt = "n",type="b",xlab="",ylab="Crops", ylim = yrange)
axis(1, at=1:15, labels=crop$EVTYPE[1:15],las=2)
```

Most damage to the property (`r property$PROPDMG1[1]*100`%) is done by tornados. Flash floods (`r property$PROPDMG1[2]*100`%) and Tstm winds (`r property$PROPDMG1[3]*100`%) are the next causes of damage to the property. However, the first reason of damage to the crop is the hail (`r crop$CROPDMG1[1]*100`%). Next in importance are the flash floods (`r crop$CROPDMG1[2]*100`%) and the floods (`r crop$CROPDMG1[3]*100`%).

## Conclusions
Tornados are the single main source of health problems and damage. Measures to minimize the effects of tornados will have a high impact. 

